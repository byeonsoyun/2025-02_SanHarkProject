# 민사법 챗봇 시스템 사용법

## 📋 시스템 개요
- **데이터**: 76,291개 민사법 판례 (계약법, 불법행위법, 물권법, 손해배상, 민사소송)
- **아키텍처**: 로컬 Django/React + 외부 GPU 서버
- **기능**: 맥락 유지, 다크/라이트 테마, 복잡도 자동 감지

## 🚀 시스템 시작하기

### 1. 기본 환경 확인
```bash
# 현재 디렉토리 확인
pwd
# 결과: /Users/sang

# 프로젝트 디렉토리로 이동
cd /Users/sang/SanHark_25_02
```

### 2. 백엔드 서버 시작
```bash
# 백엔드 디렉토리로 이동
cd backend

# 가상환경 활성화
source venv/bin/activate

# Django 서버 시작
python3 manage.py runserver
```

### 3. 프론트엔드 서버 시작 (새 터미널)
```bash
# 프론트엔드 디렉토리로 이동
cd /Users/sang/SanHark_25_02/frontend

# React 서버 시작
npm start
```

### 4. 브라우저에서 접속
- URL: http://localhost:3000
- 자동으로 브라우저가 열림

## ⚙️ 서버 설정 관리

### GPU 서버 연결 상태 확인
```bash
cd /Users/sang/SanHark_25_02/backend

# 현재 설정 확인
python3 switch_ollama.py status

# 외부 GPU 서버로 전환
python3 switch_ollama.py external

# 로컬 서버로 전환
python3 switch_ollama.py local
```

### 연결 테스트
```bash
# GPU 서버 연결 테스트
python3 test_gpu_connection.py
```

## 💬 챗봇 사용법

### 단순 질문 (데이터베이스 검색만)
- "임대차 계약"
- "손해배상"
- "부동산 매매"
- "교통사고"

### 복잡한 질문 (AI 분석 포함)
- "계약 위반 시 손해배상 범위는 어떻게 결정되나요?"
- "임대차보증금 반환청구권과 우선변제권의 관계에 대해 분석해주세요"
- "부동산 매매계약 해제 시 중개수수료 반환 기준을 설명해주세요"

### 맥락 유지 대화 예시
1. "교통사고 손해배상은 어떻게 계산하나요?"
2. "그럼 과실비율은 어떻게 정해지나요?"
3. "이 경우 보험회사의 책임은 어떻게 되나요?"

## 🔧 문제 해결

### Django 서버가 시작되지 않을 때
```bash
# 가상환경 재활성화
cd /Users/sang/SanHark_25_02/backend
source venv/bin/activate

# 포트 충돌 확인
lsof -i :8000

# 다른 포트로 시작
python3 manage.py runserver 8001
```

### React 서버가 시작되지 않을 때
```bash
# 의존성 재설치
cd /Users/sang/SanHark_25_02/frontend
npm install

# 캐시 정리 후 시작
npm start -- --reset-cache
```

### GPU 서버 연결 실패 시
```bash
# 로컬 모드로 전환
python3 switch_ollama.py local

# Django 서버 재시작
python3 manage.py runserver
```

### 외부 GPU 서버 재연결
```bash
# SSH로 GPU 서버 접속
ssh -p 11122 username@10.198.138.249

# Ollama 서비스 재시작
pkill -f ollama
OLLAMA_HOST=0.0.0.0:11434 ollama serve &

# 로컬에서 연결 테스트
python3 test_gpu_connection.py
```

## 📁 주요 파일 구조
```
/Users/sang/SanHark_25_02/
├── backend/                    # Django 백엔드
│   ├── venv/                  # Python 가상환경
│   ├── manage.py              # Django 관리 스크립트
│   ├── db.sqlite3             # 76,291개 민사법 판례 DB
│   ├── switch_ollama.py       # 서버 전환 스크립트
│   ├── test_gpu_connection.py # 연결 테스트 스크립트
│   └── chat/                  # 챗봇 앱
├── frontend/                   # React 프론트엔드
│   ├── src/                   # 소스 코드
│   ├── package.json           # 의존성 설정
│   └── public/                # 정적 파일
└── 민사법_챗봇_시스템_사용법.txt  # 이 파일
```

## 🎯 주요 기능

### 1. 지능형 질문 분류
- 단순 키워드 → 빠른 데이터베이스 검색
- 복잡한 분석 질문 → AI 모델 활용

### 2. 대화 맥락 유지
- 같은 채팅 세션 내에서 이전 대화 기억
- "그럼", "이 경우" 등의 맥락 키워드 인식

### 3. 멀티 채팅 관리
- 사이드바에서 여러 채팅 세션 관리
- 각 채팅마다 독립적인 대화 맥락

### 4. 테마 지원
- 다크/라이트 모드 전환
- 사용자 설정 자동 저장

## 📞 시스템 정보

### 서버 구성
- **로컬 서버**: Django (포트 8000) + React (포트 3000)
- **외부 GPU 서버**: 10.198.138.249:22434
- **데이터베이스**: SQLite (76,291개 민사법 판례)

### AI 모델
- **로컬 모델**: civil-law-korean (경량화, M3 최적화)
- **GPU 모델**: civil-law-expert (고성능, 상세 분석)

### 지원 분야
- 계약법 (매매, 임대차, 도급 등)
- 불법행위법 (교통사고, 의료사고 등)
- 물권법 (소유권, 담보물권 등)
- 손해배상 (재산적/정신적 피해)
- 민사소송 (절차, 증거, 판결 등)

## 🔄 일상적인 사용 흐름

1. **시스템 시작**
   ```bash
   # 터미널 1: 백엔드
   cd /Users/sang/SanHark_25_02/backend
   source venv/bin/activate
   python3 manage.py runserver
   
   # 터미널 2: 프론트엔드
   cd /Users/sang/SanHark_25_02/frontend
   npm start
   ```

2. **브라우저에서 http://localhost:3000 접속**

3. **질문 입력 및 대화**
   - 단순 검색: 키워드만 입력
   - 상세 분석: 구체적인 질문 입력
   - 연속 대화: 맥락 키워드 활용

4. **시스템 종료**
   - 각 터미널에서 Ctrl+C

## ⚠️ 주의사항

- 가상환경 활성화 필수 (source venv/bin/activate)
- 두 개의 터미널 필요 (백엔드/프론트엔드)
- GPU 서버 연결 불안정 시 로컬 모드 사용
- 복잡한 질문일수록 응답 시간 증가
- 브라우저 새로고침 시 채팅 기록 초기화

## 📝 추가 정보

이 시스템은 대한민국 민사법 전문 상담을 위해 개발되었습니다.
실제 법률 상담이 필요한 경우 전문 변호사와 상담하시기 바랍니다.

버전: 2025.01.16
개발자: SanHark Team
